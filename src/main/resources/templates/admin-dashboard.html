<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - SmartQuiz</title>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0/dist/css/select2.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-50: #eff6ff;
            --primary-100: #dbeafe;
            --primary-200: #bfdbfe;
            --primary-300: #93c5fd;
            --primary-400: #60a5fa;
            --primary-500: #3b82f6;
            --primary-600: #2563eb;
            --primary-700: #1d4ed8;
            --primary-800: #1e40af;
            --primary-900: #1e3a8a;

            --success-50: #f0fdf4;
            --success-100: #dcfce7;
            --success-200: #bbf7d0;
            --success-500: #22c55e;
            --success-600: #16a34a;

            --warning-50: #fffbeb;
            --warning-100: #fef3c7;
            --warning-500: #f59e0b;
            --warning-600: #d97706;

            --error-50: #fef2f2;
            --error-100: #fee2e2;
            --error-500: #ef4444;
            --error-600: #dc2626;

            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;

            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--gray-50) 0%, var(--primary-50) 100%);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            color: var(--gray-800);
            line-height: 1.6;
        }

        /* Header - Fully Responsive */
        header {
            background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-700) 100%);
            color: white;
            padding: clamp(0.75rem, 2vw, 1rem) clamp(1rem, 4vw, 2rem);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow-lg);
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
            flex-wrap: wrap;
            gap: 1rem;
        }

        header h1 {
            margin: 0;
            font-size: clamp(1.25rem, 4vw, 1.875rem);
            font-weight: 700;
            user-select: none;
            display: flex;
            align-items: center;
            gap: clamp(0.5rem, 2vw, 0.75rem);
            flex: 1;
        }

        header h1::before {
            content: "ðŸŽ“";
            font-size: clamp(1.5rem, 5vw, 2rem);
        }

        .logout-btn {
            background: var(--error-500);
            border: none;
            padding: clamp(0.625rem, 2vw, 0.75rem) clamp(1rem, 3vw, 1.5rem);
            border-radius: clamp(0.5rem, 1.5vw, 0.75rem);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: clamp(0.8125rem, 2.5vw, 0.875rem);
            min-height: 44px;
            white-space: nowrap;
        }

        .logout-btn:hover, .logout-btn:focus {
            background: var(--error-600);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
            outline: none;
        }

        .logout-btn::before {
            content: "ðŸšª";
        }

        /* Container - Responsive */
        .container {
            max-width: min(95vw, 1200px);
            margin: clamp(1rem, 3vw, 2rem) auto;
            background: white;
            border-radius: clamp(1rem, 2vw, 1.5rem);
            box-shadow: var(--shadow-xl);
            overflow: hidden;
            border: 1px solid var(--gray-200);
        }

        .container-inner {
            padding: clamp(1rem, 4vw, 2rem);
        }

        /* Toast Messages - Responsive */
        .toast-success, .toast-error {
            padding: clamp(0.75rem, 3vw, 1rem) clamp(1rem, 4vw, 1.5rem);
            border-radius: clamp(0.5rem, 1.5vw, 0.75rem);
            margin-bottom: clamp(1rem, 3vw, 1.5rem);
            display: flex;
            align-items: flex-start;
            gap: clamp(0.5rem, 2vw, 0.75rem);
            font-weight: 500;
            font-size: clamp(0.875rem, 2.5vw, 1rem);
            word-break: break-word;
        }

        .toast-success {
            background: linear-gradient(135deg, var(--success-50) 0%, var(--success-100) 100%);
            color: var(--success-600);
            border: 1px solid var(--success-200);
        }

        .toast-success::before {
            content: "âœ…";
            font-size: clamp(1rem, 3vw, 1.25rem);
            flex-shrink: 0;
        }

        .toast-error {
            background: linear-gradient(135deg, var(--error-50) 0%, var(--error-100) 100%);
            color: var(--error-600);
            border: 1px solid var(--error-200);
        }

        .toast-error::before {
            content: "âŒ";
            font-size: clamp(1rem, 3vw, 1.25rem);
            flex-shrink: 0;
        }

        /* Navigation Cards - Responsive Grid */
        .flash-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(250px, 100%), 1fr));
            gap: clamp(1rem, 3vw, 1.5rem);
            margin-bottom: clamp(1.5rem, 4vw, 2rem);
        }

        .card {
            background: linear-gradient(135deg, var(--primary-50) 0%, white 100%);
            border: 2px solid var(--primary-100);
            border-radius: clamp(0.75rem, 2vw, 1rem);
            padding: clamp(1.25rem, 4vw, 2rem) clamp(1rem, 3vw, 1.5rem);
            cursor: pointer;
            font-size: clamp(1rem, 3vw, 1.125rem);
            font-weight: 600;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            color: var(--primary-700);
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 0.75rem;
        }

        .card::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }

        .card:hover::before {
            left: 100%;
        }

        .card:hover, .card:focus {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-300);
            outline: none;
        }

        .card.active {
            background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-700) 100%);
            color: white;
            border-color: var(--primary-600);
            box-shadow: var(--shadow-lg);
        }

        .card i {
            font-size: clamp(1.5rem, 4vw, 2rem);
            display: block;
        }

        /* Sections with Animation */
        .section {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Headings - Responsive */
        h2 {
            font-size: clamp(1.5rem, 4vw, 1.875rem);
            font-weight: 700;
            color: var(--primary-700);
            margin-bottom: clamp(1rem, 3vw, 1.5rem);
            padding-bottom: clamp(0.5rem, 2vw, 0.75rem);
            border-bottom: 3px solid var(--primary-200);
            position: relative;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        h2::after {
            content: "";
            position: absolute;
            bottom: -3px;
            left: 0;
            width: clamp(50px, 15vw, 60px);
            height: 3px;
            background: linear-gradient(90deg, var(--primary-600), var(--primary-400));
            border-radius: 2px;
        }

        /* Form Styling - Responsive */
        .form-section {
            background: linear-gradient(135deg, var(--gray-50) 0%, white 100%);
            padding: clamp(1.25rem, 4vw, 2rem);
            border-radius: clamp(0.75rem, 2vw, 1rem);
            border: 1px solid var(--gray-200);
            box-shadow: var(--shadow-sm);
        }

        .form-group {
            margin-bottom: clamp(1rem, 3vw, 1.5rem);
        }

        label {
            font-weight: 600;
            display: block;
            margin-bottom: clamp(0.375rem, 1.5vw, 0.5rem);
            color: var(--gray-700);
            font-size: clamp(0.8125rem, 2.5vw, 0.875rem);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        label i {
            margin-right: 0.5rem;
            color: var(--primary-600);
            width: 1rem;
        }

        input, textarea, select {
            width: 100%;
            padding: clamp(0.75rem, 2.5vw, 0.875rem) clamp(0.875rem, 3vw, 1rem);
            border: 2px solid var(--gray-200);
            border-radius: clamp(0.5rem, 1.5vw, 0.75rem);
            font-size: clamp(0.875rem, 2.5vw, 1rem);
            transition: all 0.2s ease;
            background: white;
            font-family: inherit;
            min-height: 48px;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px var(--primary-100);
            transform: translateY(-1px);
        }

        textarea {
            resize: vertical;
            min-height: clamp(100px, 20vw, 120px);
        }

        /* Button Styling - Enhanced Responsive */
        button {
            background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-700) 100%);
            color: white;
            border: none;
            padding: clamp(0.75rem, 2.5vw, 0.875rem) clamp(1.5rem, 4vw, 2rem);
            border-radius: clamp(0.5rem, 1.5vw, 0.75rem);
            cursor: pointer;
            font-weight: 600;
            font-size: clamp(0.875rem, 2.5vw, 1rem);
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            min-height: 48px;
            font-family: inherit;
        }

        button:hover, button:focus {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            background: linear-gradient(135deg, var(--primary-700) 0%, var(--primary-800) 100%);
            outline: none;
        }

        /* Table - Responsive with Horizontal Scroll */
        .table-container {
            background: white;
            border-radius: clamp(0.75rem, 1.5vw, 1rem);
            overflow: auto;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--gray-200);
            -webkit-overflow-scrolling: touch;
        }

        table {
            width: 100%;
            min-width: 800px;
            border-collapse: collapse;
        }

        th {
            background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-700) 100%);
            color: white;
            padding: clamp(0.75rem, 2vw, 1rem);
            font-weight: 600;
            text-align: left;
            font-size: clamp(0.75rem, 2vw, 0.875rem);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            white-space: nowrap;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        td {
            padding: clamp(0.75rem, 2vw, 1rem);
            border-bottom: 1px solid var(--gray-100);
            vertical-align: middle;
            font-size: clamp(0.8125rem, 2vw, 0.875rem);
        }

        tr:hover {
            background: var(--gray-50);
        }

        tr:last-child td {
            border-bottom: none;
        }

        /* Action Buttons - Mobile Optimized */
        .btn-action {
            padding: clamp(0.375rem, 1.5vw, 0.5rem) clamp(0.75rem, 2vw, 1rem);
            border-radius: clamp(0.375rem, 1vw, 0.5rem);
            text-decoration: none;
            cursor: pointer;
            font-size: clamp(0.75rem, 2vw, 0.875rem);
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.375rem;
            margin: 0.125rem;
            transition: all 0.2s ease;
            border: none;
            min-height: 36px;
            white-space: nowrap;
            font-family: inherit;
        }

        .btn-edit {
            background: linear-gradient(135deg, var(--warning-500) 0%, var(--warning-600) 100%);
            color: white;
        }

        .btn-edit:hover, .btn-edit:focus {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
            outline: none;
        }

        .btn-delete {
            background: linear-gradient(135deg, var(--error-500) 0%, var(--error-600) 100%);
            color: white;
        }

        .btn-delete:hover, .btn-delete:focus {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
            outline: none;
        }

        .btn-release {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
        }

        .btn-release:hover, .btn-release:focus {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
            outline: none;
        }

        .btn-download {
            background: linear-gradient(135deg, var(--success-500) 0%, var(--success-600) 100%);
            color: white;
        }

        .btn-download:hover, .btn-download:focus {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
            outline: none;
        }

        /* Release Form - Responsive */
        .release-form {
            background: linear-gradient(135deg, var(--primary-50) 0%, white 100%);
            border: 2px solid var(--primary-200);
            padding: clamp(1rem, 3vw, 1.5rem);
            border-radius: clamp(0.75rem, 1.5vw, 1rem);
            margin-top: clamp(0.75rem, 2vw, 1rem);
            box-shadow: var(--shadow-sm);
        }

        .release-form label {
            display: inline-flex;
            align-items: center;
            margin-right: clamp(1rem, 3vw, 1.5rem);
            margin-bottom: clamp(0.5rem, 2vw, 0.75rem);
            font-weight: 500;
            cursor: pointer;
            gap: 0.5rem;
            font-size: clamp(0.8125rem, 2.5vw, 0.875rem);
        }

        .release-form input[type="radio"] {
            width: auto;
            margin: 0;
            min-height: auto;
        }

        /* Status Badges - Responsive */
        .status-badge {
            padding: clamp(0.25rem, 1vw, 0.375rem) clamp(0.5rem, 2vw, 0.75rem);
            border-radius: 9999px;
            font-size: clamp(0.6875rem, 2vw, 0.75rem);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            display: inline-block;
            white-space: nowrap;
        }

        .status-all {
            background: var(--success-100);
            color: var(--success-600);
        }

        .status-selected {
            background: var(--primary-100);
            color: var(--primary-600);
        }

        /* Empty State - Responsive */
        .empty-state {
            text-align: center;
            padding: clamp(2rem, 6vw, 3rem) clamp(1rem, 4vw, 2rem);
            color: var(--gray-500);
        }

        .empty-state i {
            font-size: clamp(3rem, 8vw, 4rem);
            margin-bottom: clamp(0.75rem, 2vw, 1rem);
            opacity: 0.5;
        }

        .empty-state p {
            font-size: clamp(0.875rem, 2.5vw, 1rem);
            margin: 0;
        }

        /* Select2 Responsive Customization */
        .select2-container {
            font-size: clamp(0.875rem, 2.5vw, 1rem) !important;
        }

        .select2-container--default .select2-selection--multiple {
            border: 2px solid var(--gray-200) !important;
            border-radius: clamp(0.5rem, 1.5vw, 0.75rem) !important;
            padding: clamp(0.375rem, 1.5vw, 0.5rem) !important;
            min-height: 48px !important;
        }

        .select2-container--default.select2-container--focus .select2-selection--multiple {
            border-color: var(--primary-500) !important;
            box-shadow: 0 0 0 3px var(--primary-100) !important;
        }

        /* Mobile-Specific Breakpoints */
        @media (max-width: 480px) {
            header {
                flex-direction: column;
                align-items: stretch;
                gap: 0.75rem;
            }

            header h1 {
                justify-content: center;
            }

            .logout-btn {
                align-self: center;
            }

            .container {
                margin: 0.75rem;
                border-radius: 1rem;
            }

            .container-inner {
                padding: 1rem;
            }

            .flash-cards {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .card {
                min-height: 100px;
                padding: 1rem;
            }

            .table-container {
                margin: 0 -1rem;
                border-radius: 0;
                border-left: none;
                border-right: none;
            }

            .btn-action {
                font-size: 0.75rem;
                padding: 0.375rem 0.625rem;
                gap: 0.25rem;
            }

            .btn-action i {
                font-size: 0.875rem;
            }

            /* Stack action buttons on very small screens */
            td > div {
                display: flex;
                flex-direction: column;
                gap: 0.25rem;
            }
        }

        @media (max-width: 320px) {
            .container {
                margin: 0.5rem;
                border-radius: 0.75rem;
            }

            .form-section {
                padding: 1rem;
            }
        }

        /* Tablet Responsive */
        @media (min-width: 481px) and (max-width: 768px) {
            .flash-cards {
                grid-template-columns: repeat(2, 1fr);
            }

            table {
                min-width: 700px;
            }
        }

        /* Desktop Hover Effects */
        @media (min-width: 1024px) {
            .container:hover {
                box-shadow: var(--shadow-xl);
            }

            .table-container {
                overflow: visible;
            }

            table {
                min-width: 100%;
            }

            /* Show more action buttons inline on desktop */
            td > div {
                display: flex;
                flex-wrap: wrap;
                gap: 0.25rem;
            }
        }

        /* High contrast support */
        @media (prefers-contrast: high) {
            .card, .form-section, .table-container {
                border-width: 3px;
            }

            button, .btn-action {
                border: 2px solid currentColor;
            }
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(135deg, var(--gray-900) 0%, var(--primary-900) 100%);
                color: var(--gray-200);
            }

            .container, .form-section, .table-container {
                background: var(--gray-800);
                border-color: var(--gray-700);
                color: var(--gray-200);
            }

            .card {
                background: linear-gradient(135deg, var(--gray-800) 0%, var(--gray-700) 100%);
                border-color: var(--gray-600);
                color: var(--primary-300);
            }

            .card.active {
                background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-700) 100%);
                color: white;
            }

            h2 {
                color: var(--primary-300);
                border-bottom-color: var(--gray-700);
            }

            input, textarea, select {
                background: var(--gray-700);
                border-color: var(--gray-600);
                color: var(--gray-200);
            }

            input:focus, textarea:focus, select:focus {
                background: var(--gray-600);
                border-color: var(--primary-400);
            }

            th {
                background: linear-gradient(135deg, var(--primary-700) 0%, var(--primary-800) 100%);
            }

            tr:hover {
                background: var(--gray-700);
            }

            .toast-success {
                background: linear-gradient(135deg, var(--success-900) 0%, var(--gray-800) 100%);
                color: #4ade80;
                border-color: var(--success-800);
            }

            .toast-error {
                background: linear-gradient(135deg, var(--error-900) 0%, var(--gray-800) 100%);
                color: #f87171;
                border-color: var(--error-800);
            }

            .release-form {
                background: linear-gradient(135deg, var(--gray-700) 0%, var(--gray-800) 100%);
                border-color: var(--gray-600);
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border: 2px solid var(--gray-300);
            border-radius: 50%;
            border-top-color: var(--primary-600);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

<header>
    <h1>SmartExam</h1>
    <form th:action="@{/logout}" method="post">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <button type="submit" class="logout-btn">Logout</button>
    </form>
</header>

<div class="container">
    <div class="container-inner">
        <!-- Toast Message -->
        <div th:if="${toastMessage}" th:text="${toastMessage}"
             th:classappend="' toast-' + ${toastType}">
        </div>

        <!-- Navigation Cards -->
        <div class="flash-cards">
            <div class="card active" id="card-create" onclick="showSection('create')" tabindex="0">
                <i class="fas fa-plus-circle"></i>
                Create New Exam
            </div>
            <div class="card" id="card-list" onclick="showSection('list')" tabindex="0">
                <i class="fas fa-list-alt"></i>
                Created Exams
            </div>
        </div>

        <!-- Create Exam Section -->
        <div class="section active" id="section-create">
            <div class="form-section">
                <h2><i class="fas fa-plus-circle"></i> Create New Exam</h2>
                <form th:action="@{/admin/create-exam}" th:object="${exam}" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    <div class="form-group">
                        <label><i class="fas fa-heading"></i> Title:</label>
                        <input type="text" th:field="*{title}" required placeholder="Enter exam title">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-align-left"></i> Description:</label>
                        <textarea th:field="*{description}" required placeholder="Enter exam description"></textarea>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-clock"></i> Duration (Minutes):</label>
                        <input type="number" th:field="*{durationMinutes}" min="1" required placeholder="60">
                    </div>
                    <button type="submit">
                        <i class="fas fa-save"></i>
                        Create Exam
                    </button>
                </form>
            </div>
        </div>

        <!-- List Exams Section -->
        <div class="section" id="section-list">
            <h2><i class="fas fa-list-alt"></i> My Created Exams</h2>
            <div class="table-container">
                <table>
                    <thead>
                    <tr>
                        <th><i class="fas fa-heading"></i> Title</th>
                        <th><i class="fas fa-align-left"></i> Description</th>
                        <th><i class="fas fa-clock"></i> Duration</th>
                        <th><i class="fas fa-share-alt"></i> Release</th>
                        <th><i class="fas fa-calendar"></i> Created Date</th>
                        <th><i class="fas fa-cogs"></i> Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="exam,stat : ${exams}">
                        <td>
                            <strong th:text="${exam.title}"></strong>
                        </td>
                        <td th:text="${exam.description}"></td>
                        <td>
                            <span class="status-badge" th:text="${exam.durationMinutes} + ' mins'"></span>
                        </td>
                        <td>
                            <span th:if="${exam.releaseToAll}" class="status-badge status-all">
                                <i class="fas fa-globe"></i> All Users
                            </span>
                            <span th:if="${!exam.releaseToAll}" class="status-badge status-selected"
                                  th:text="'Selected (' + ${#lists.size(exam.allowedUsers)} + ')'">
                                <i class="fas fa-users"></i>
                            </span>
                        </td>
                        <td th:text="${#temporals.format(exam.createdDate, 'dd-MM-yyyy HH:mm')}"></td>
                        <td>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.25rem;">
                                <a th:href="@{/admin/edit-exam/{id}(id=${exam.id})}" class="btn-action btn-edit">
                                    <i class="fas fa-edit"></i> Edit
                                </a>
                                <form th:action="@{/admin/delete-exam/{id}(id=${exam.id})}" method="post" style="display:inline;">
                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                    <button type="button" class="btn-action btn-delete" onclick="confirmDelete(this.form)">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </form>
                                <button type="button" class="btn-action btn-release" onclick="toggleReleaseForm([[${stat.index}]])">
                                    <i class="fas fa-share-alt"></i> Release
                                </button>
                                <a href="#"
                                   th:href="@{/admin/export-exam-attempts/{id}(id=${exam.id})}"
                                   class="btn-action btn-download"
                                   onclick="return confirmDownload();">
                                    <i class="fas fa-download"></i> Download
                                </a>
                            </div>

                            <div class="release-form" id="release-form-[[${stat.index}]]" style="display:none;">
                                <form th:action="@{/admin/update-release/{id}(id=${exam.id})}" method="post">
                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                    <div style="margin-bottom: 1rem;">
                                        <label>
                                            <input type="radio" name="releaseToAll" value="true" th:checked="${exam.releaseToAll}">
                                            <i class="fas fa-globe"></i> All Users
                                        </label>
                                        <label>
                                            <input type="radio" name="releaseToAll" value="false" th:checked="${!exam.releaseToAll}">
                                            <i class="fas fa-users"></i> Selected Users
                                        </label>
                                    </div>
                                    <div id="inline-select-users-[[${stat.index}]]" style="display:none; margin-bottom: 1rem;">
                                        <select name="selectedUserIds" multiple class="user-select">
                                            <option th:each="u : ${allUsers}" th:value="${u.id}" th:text="${u.username}" th:selected="${exam.allowedUsers.contains(u)}"></option>
                                        </select>
                                    </div>
                                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                        <button type="submit">
                                            <i class="fas fa-save"></i> Update
                                        </button>
                                        <button type="button" onclick="toggleReleaseForm([[${stat.index}]])" style="background: var(--gray-500);">
                                            <i class="fas fa-times"></i> Cancel
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(exams)}">
                        <td colspan="6">
                            <div class="empty-state">
                                <i class="fas fa-inbox"></i>
                                <p>No exams created yet. Use 'Create New Exam' above to get started.</p>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0/dist/js/select2.min.js"></script>
<script>
    function showSection(name) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.card').forEach(c => c.classList.remove('active'));
        document.getElementById('section-' + name).classList.add('active');
        document.getElementById('card-' + name).classList.add('active');
    }

    function confirmDelete(formElement) {
        if (confirm("âš ï¸ Are you sure you want to delete this exam?\n\nThis action cannot be undone and will permanently remove all associated data.")) {
            formElement.submit();
        }
    }

    function confirmDownload() {
        return confirm("ðŸ“¥ Download exam attempts report?\n\nThis will generate and download a comprehensive report of all attempts for this exam.");
    }

    function toggleReleaseForm(idx) {
        let form = document.getElementById('release-form-' + idx);
        form.style.display = (form.style.display === 'block') ? 'none' : 'block';

        let radios = form.querySelectorAll('input[name="releaseToAll"]');
        let selectDiv = document.getElementById('inline-select-users-' + idx);

        function updateVis() {
            let chk = Array.from(radios).find(r => r.checked);
            selectDiv.style.display = (chk && chk.value === 'false') ? 'block' : 'none';
        }

        radios.forEach(r => r.addEventListener('change', updateVis));
        updateVis();

        $(selectDiv).find('.user-select').select2({
            placeholder: "ðŸ” Search and select users",
            allowClear: true,
            width: '100%',
            theme: 'default'
        });
    }

    // Keyboard navigation for cards
    document.querySelectorAll('.card').forEach(card => {
        card.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                card.click();
            }
        });
    });

    $(document).ready(function() {
        $('.user-select').select2({
            placeholder: "ðŸ” Search and select users",
            allowClear: true,
            width: '100%',
            theme: 'default'
        });

        // Add smooth scrolling for better UX
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth'
                    });
                }
            });
        });

        // Responsive table scroll indicator
        const tableContainers = document.querySelectorAll('.table-container');
        tableContainers.forEach(container => {
            function updateScrollIndicator() {
                const hasHorizontalScroll = container.scrollWidth > container.clientWidth;
                if (hasHorizontalScroll && container.scrollLeft === 0) {
                    container.style.boxShadow = 'inset -10px 0 10px -10px rgba(0,0,0,0.1)';
                } else if (hasHorizontalScroll && container.scrollLeft > 0 && container.scrollLeft < container.scrollWidth - container.clientWidth) {
                    container.style.boxShadow = 'inset 10px 0 10px -10px rgba(0,0,0,0.1), inset -10px 0 10px -10px rgba(0,0,0,0.1)';
                } else if (hasHorizontalScroll && container.scrollLeft >= container.scrollWidth - container.clientWidth) {
                    container.style.boxShadow = 'inset 10px 0 10px -10px rgba(0,0,0,0.1)';
                } else {
                    container.style.boxShadow = 'var(--shadow-md)';
                }
            }

            container.addEventListener('scroll', updateScrollIndicator);
            window.addEventListener('resize', updateScrollIndicator);
            updateScrollIndicator();
        });
    });

    // Add loading states to buttons
    document.addEventListener('DOMContentLoaded', function() {
        const forms = document.querySelectorAll('form');
        forms.forEach(form => {
            form.addEventListener('submit', function() {
                const submitBtn = form.querySelector('button[type="submit"]');
                if (submitBtn && !submitBtn.disabled) {
                    const originalContent = submitBtn.innerHTML;
                    submitBtn.innerHTML = '<span class="loading"></span> Processing...';
                    submitBtn.disabled = true;

                    // Re-enable after 5 seconds as fallback
                    setTimeout(() => {
                        submitBtn.innerHTML = originalContent;
                        submitBtn.disabled = false;
                    }, 5000);
                }
            });
        });

        // Touch/swipe improvements for mobile
        if ('ontouchstart' in window) {
            document.body.classList.add('touch-device');

            // Add touch feedback to interactive elements
            const touchElements = document.querySelectorAll('button, .btn-action, .card');
            touchElements.forEach(element => {
                element.addEventListener('touchstart', function() {
                    this.style.transform = 'scale(0.98)';
                });

                element.addEventListener('touchend', function() {
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 100);
                });
            });
        }
    });

    // Improved error handling for AJAX operations
    function handleFormError(message) {
        const toast = document.createElement('div');
        toast.className = 'toast-error';
        toast.textContent = message;

        const container = document.querySelector('.container-inner');
        container.insertBefore(toast, container.firstChild);

        // Auto remove after 5 seconds
        setTimeout(() => {
            toast.remove();
        }, 5000);
    }

    // Performance optimization: Debounce resize events
    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }

    // Responsive font size adjustment
    const debouncedResize = debounce(function() {
        // Adjust table font size based on viewport
        const tables = document.querySelectorAll('table');
        const viewportWidth = window.innerWidth;

        tables.forEach(table => {
            if (viewportWidth < 480) {
                table.style.fontSize = '0.75rem';
            } else if (viewportWidth < 768) {
                table.style.fontSize = '0.8125rem';
            } else {
                table.style.fontSize = '';
            }
        });
    }, 100);

    window.addEventListener('resize', debouncedResize);
</script>

</body>
</html>